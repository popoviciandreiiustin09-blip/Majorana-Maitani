<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OS26 ¬∑ Aula Smart</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #ddeeff;
    --panel: #eaf4ff;
    --panel2: #f0f8ff;
    --border: rgba(80, 150, 220, 0.25);
    --glow: #4a90d9;
    --glow2: #6ab0e8;
    --accent: #2e7fc2;
    --warn: #5ba3d9;
    --text: #1e4d7a;
    --text-dim: #7aafd4;
    --grid: rgba(80, 150, 220, 0.07);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    font-family: 'Rajdhani', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  /* Animated background grid */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(var(--grid) 1px, transparent 1px),
      linear-gradient(90deg, var(--grid) 1px, transparent 1px);
    background-size: 40px 40px;
    z-index: 0;
    animation: gridScroll 20s linear infinite;
  }

  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(100,180,255,0.18) 0%, transparent 70%);
    z-index: 0;
    pointer-events: none;
  }

  @keyframes gridScroll {
    from { background-position: 0 0; }
    to { background-position: 40px 40px; }
  }

  .wrapper {
    position: relative;
    z-index: 1;
    max-width: 1300px;
    margin: 0 auto;
    padding: 30px 20px;
  }

  /* HEADER */
  header {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
  }

  .header-badge {
    display: inline-block;
    font-family: 'Rajdhani', sans-serif;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 4px;
    color: var(--glow);
    text-transform: uppercase;
    border: 1px solid rgba(0,200,255,0.3);
    padding: 5px 16px;
    border-radius: 20px;
    margin-bottom: 16px;
    background: rgba(0,200,255,0.06);
    animation: fadeSlideDown 0.6s ease both;
  }

  h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(1.8rem, 4vw, 3.2rem);
    font-weight: 900;
    letter-spacing: 2px;
    background: linear-gradient(135deg, #2a7fc4 0%, #5aabea 50%, #1a5fa0 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.1;
    animation: fadeSlideDown 0.7s ease both;
  }

  .subtitle {
    font-size: 14px;
    font-weight: 300;
    letter-spacing: 6px;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-top: 10px;
    animation: fadeSlideDown 0.8s ease both;
  }
  .sottotitoli{
   font-size: 14px;
    font-weight: 300;
    letter-spacing: 6px;
    color:  var(--text-dim);
    text-transform: uppercase;
    margin-top: 10px;
    animation: fadeSlideDown 0.8s ease both;
  }

  .header-line {
    width: 80px;
    height: 2px;
    background: linear-gradient(90deg, transparent, #4a90d9, transparent);
    margin: 20px auto 0;
    animation: fadeSlideDown 0.9s ease both;
  }

  @keyframes fadeSlideDown {
    from { opacity: 0; transform: translateY(-15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* STATUS BAR */
  .status-bar {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    font-size: 12px;
    letter-spacing: 2px;
    color: var(--text-dim);
    font-weight: 600;
    text-transform: uppercase;
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #2e7fc2;
    box-shadow: 0 0 10px #2e7fc2;
    animation: pulse 2s ease infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 10px #2e7fc2; }
    50% { opacity: 0.4; box-shadow: 0 0 4px #2e7fc2; }
  }

  /* METRIC CARDS */
  .metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 16px;
    margin-bottom: 30px;
  }

  .metric {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px 18px;
    position: relative;
    overflow: hidden;
    transition: transform 0.35s cubic-bezier(0.34,1.56,0.64,1), border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    animation: cardIn 0.6s ease both;
    cursor: default;
  }

  .metric:nth-child(1) { animation-delay: 0.1s; }
  .metric:nth-child(2) { animation-delay: 0.2s; }
  .metric:nth-child(3) { animation-delay: 0.3s; }
  .metric:nth-child(4) { animation-delay: 0.4s; }
  .metric:nth-child(5) { animation-delay: 0.5s; }
  .metric:nth-child(6) { animation-delay: 0.6s; }

  @keyframes cardIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .metric::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--metric-color, var(--glow));
    opacity: 0.7;
  }

  .metric::after {
    content: '';
    position: absolute;
    top: -30%;
    right: -20%;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--metric-color, var(--glow)), transparent 70%);
    opacity: 0.07;
    pointer-events: none;
  }

  .metric:hover {
    transform: scale(1.08) translateY(-4px);
    border-color: var(--metric-color, var(--glow));
    box-shadow: 0 16px 40px rgba(74, 144, 217, 0.22), 0 0 0 1.5px var(--metric-color, var(--glow));
    background: #d6ecff;
    z-index: 10;
  }

  .metric:hover .metric-label {
    color: #1a5fa0;
  }

  .metric:hover .metric-value {
    color: #1a5fa0;
  }

  .metric:hover .metric-unit {
    color: #3a7fc2;
  }

  .metric:hover .metric-icon {
    transform: scale(1.15);
  }

  .metric-icon {
    font-size: 24px;
    margin-bottom: 10px;
    display: block;
    filter: drop-shadow(0 0 6px rgba(255,255,255,0.3));
    transition: transform 0.3s ease;
  }

  .metric-label {
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-dim);
    font-weight: 600;
    margin-bottom: 6px;
    transition: color 0.3s ease;
  }

  .metric-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 26px;
    font-weight: 700;
    color: var(--text);
    line-height: 1;
    transition: color 0.3s ease;
  }

  .metric-unit {
    font-family: 'Rajdhani', sans-serif;
    font-size: 13px;
    color: var(--text-dim);
    font-weight: 400;
    margin-left: 3px;
    transition: color 0.3s ease;
  }

  /* Individual card colors */
  .metric.temp   { --metric-color: #5ba8e8; }
  .metric.umid   { --metric-color: #4abcd4; }
  .metric.lux    { --metric-color: #7ab8f0; }
  .metric.people { --metric-color: #3a8dcc; }
  .metric.tpred  { --metric-color: #85c4f0; }
  .metric.tempo  { --metric-color: #2e7fc2; }

  /* CHARTS */
  .charts {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
    gap: 20px;
    margin-top: 10px;
  }

  .chart-box {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 24px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.3s ease;
    animation: cardIn 0.7s ease both;
  }

  .chart-box:nth-child(1) { animation-delay: 0.2s; }
  .chart-box:nth-child(2) { animation-delay: 0.35s; }
  .chart-box:nth-child(3) { animation-delay: 0.5s; }

  .chart-box::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse 60% 40% at 50% 0%, rgba(80,150,220,0.06), transparent);
    pointer-events: none;
  }

  .chart-box:hover {
    border-color: rgba(0, 200, 255, 0.3);
    box-shadow: 0 4px 30px rgba(74, 144, 217, 0.1);
  }

  .chart-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 18px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .chart-title::before {
    content: '';
    display: block;
    width: 8px;
    height: 8px;
    border-radius: 2px;
    background: var(--chart-accent, var(--glow));
  }

  .chart-box.temp-chart  { --chart-accent: #5ba8e8; }
  .chart-box.lux-chart   { --chart-accent: #7ab8f0; }
  .chart-box.umid-chart  { --chart-accent: #4abcd4; }

  /* FOOTER */
  footer {
    text-align: center;
    margin-top: 40px;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--text-dim);
    text-transform: uppercase;
    opacity: 0.6;
  }

  /* Scanning line effect */
  .scan-line {
    position: fixed;
    left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, #4a90d9, transparent);
    opacity: 0.2;
    z-index: 999;
    pointer-events: none;
    animation: scanLine 8s linear infinite;
  }

  @keyframes scanLine {
    from { top: -2px; }
    to   { top: 100vh; }
  }

  /* Corner decorations */
  .corner-dec {
    position: fixed;
    width: 60px;
    height: 60px;
    pointer-events: none;
    z-index: 2;
    opacity: 0.3;
  }
  .corner-dec.tl { top: 20px; left: 20px; border-top: 2px solid #4a90d9; border-left: 2px solid #4a90d9; }
  .corner-dec.tr { top: 20px; right: 20px; border-top: 2px solid #4a90d9; border-right: 2px solid #4a90d9; }
  .corner-dec.bl { bottom: 20px; left: 20px; border-bottom: 2px solid #4a90d9; border-left: 2px solid #4a90d9; }
  .corner-dec.br { bottom: 20px; right: 20px; border-bottom: 2px solid #4a90d9; border-right: 2px solid #4a90d9; }
</style>
</head>
<body>

<div class="scan-line"></div>
<div class="corner-dec tl"></div>
<div class="corner-dec tr"></div>
<div class="corner-dec bl"></div>
<div class="corner-dec br"></div>

<div class="wrapper">

  <header>
    <div class="header-badge">I.I.S. Majorana-Maitani</div>
    <h1>SENSORI, ENERGIA<br>INTELLIGENTE</h1>
    <p class="subtitle">Smart Classroom Monitoring System</p>
    <p class="sottotitoli">OS26</p>
    <div class="header-line"></div>
  </header>

  <div class="status-bar">
    <div class="status-dot"></div>
    <span>Sistema attivo</span>
    <span>¬∑</span>
    <span>Aggiornamento ogni 5s</span>
    <span>¬∑</span>
    <span id="last-update">‚Äî</span>
  </div>

  <div class="metrics">
    <div class="metric temp">
      <span class="metric-icon">üå°</span>
      <div class="metric-label">Temperatura</div>
      <div class="metric-value"><span id="temp">--</span><span class="metric-unit">¬∞C</span></div>
    </div>
    <div class="metric umid">
      <span class="metric-icon">üíß</span>
      <div class="metric-label">Umidit√†</div>
      <div class="metric-value"><span id="umid">--</span><span class="metric-unit">%</span></div>
    </div>
    <div class="metric lux">
      <span class="metric-icon">üí°</span>
      <div class="metric-label">Luminosit√†</div>
      <div class="metric-value"><span id="lux">--</span></div>
    </div>
    <div class="metric people">
      <span class="metric-icon">üë•</span>
      <div class="metric-label">Persone</div>
      <div class="metric-value"><span id="people">--</span></div>
    </div>
    <div class="metric tpred">
      <span class="metric-icon">üìà</span>
      <div class="metric-label">T Predetta</div>
      <div class="metric-value"><span id="tpred">--</span><span class="metric-unit">¬∞C</span></div>
    </div>
    <div class="metric tempo">
      <span class="metric-icon">‚è±</span>
      <div class="metric-label">Tempo</div>
      <div class="metric-value" style="font-size:18px;"><span id="tempo">--</span></div>
    </div>
  </div>

  <div class="charts">
    <div class="chart-box temp-chart">
      <div class="chart-title">Temperatura ¬∑ ¬∞C</div>
      <canvas id="tempChart"></canvas>
    </div>
    <div class="chart-box lux-chart">
      <div class="chart-title">Luminosit√† ¬∑ LUX</div>
      <canvas id="luxChart"></canvas>
    </div>
    <div class="chart-box umid-chart">
      <div class="chart-title">Umidit√† ¬∑ %</div>
      <canvas id="umidChart"></canvas>
    </div>
  </div>

  <footer>OS26 Smart Classroom ¬∑ Dati aggiornati in tempo reale</footer>

</div>

<script>
const url = "https://script.google.com/macros/s/AKfycbwSdb_OrTqt-X3loLK-zE1BfgS2CWHUhf868IJrwIwcV0JLPAXSdevev64yX0mj52TTPQ/exec";

let labels = [], tempData = [], luxData = [], umidData = [], predData = [];

Chart.defaults.color = '#7aafd4';
Chart.defaults.font.family = "'Rajdhani', sans-serif";
Chart.defaults.font.size = 12;

function makeGradient(ctx, colorA, colorB) {
  const gradient = ctx.createLinearGradient(0, 0, 0, 200);
  gradient.addColorStop(0, colorA);
  gradient.addColorStop(1, colorB);
  return gradient;
}

function creaGrafico(id, label, data, borderColor, gradientA, gradientB) {
  const canvas = document.getElementById(id);
  const ctx = canvas.getContext('2d');
  const gradient = makeGradient(ctx, gradientA, gradientB);

  return new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{
        label,
        data,
        tension: 0.4,
        borderColor,
        borderWidth: 2,
        backgroundColor: gradient,
        fill: true,
        pointRadius: 3,
        pointBackgroundColor: borderColor,
        pointBorderColor: '#eaf4ff',
        pointBorderWidth: 1.5,
        pointHoverRadius: 6,
      }]
    },
    options: {
      responsive: true,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#eaf4ff',
          borderColor: 'rgba(80,150,220,0.25)',
          borderWidth: 1,
          titleFont: { family: 'Orbitron', size: 11 },
          bodyFont: { family: 'Rajdhani', size: 13 },
          titleColor: '#1e4d7a',
          bodyColor: '#3a7ab8',
          padding: 10,
        }
      },
      scales: {
        x: {
          grid: { color: 'rgba(80,150,220,0.1)' },
          ticks: {
            maxTicksLimit: 6,
            maxRotation: 0,
            color: '#7aafd4',
            font: { size: 10 }
          },
          border: { color: 'rgba(80,150,220,0.2)' }
        },
        y: {
          grid: { color: 'rgba(80,150,220,0.1)' },
          ticks: { color: '#7aafd4', font: { size: 11 } },
          border: { color: 'rgba(80,150,220,0.2)' }
        }
      }
    }
  });
}

const tempChart = creaGrafico("tempChart", "Temperatura ¬∞C", tempData, "#5ba8e8", "rgba(91,168,232,0.3)",  "rgba(91,168,232,0.0)");
const luxChart  = creaGrafico("luxChart",  "Luminosit√†",     luxData,  "#7ab8f0", "rgba(122,184,240,0.3)", "rgba(122,184,240,0.0)");
const umidChart = creaGrafico("umidChart", "Umidit√† %",      umidData, "#4abcd4", "rgba(74,188,212,0.3)",  "rgba(74,188,212,0.0)");

function ultimoValore(col, dati) {
  for (let i = dati.length - 1; i >= 0; i--) {
    if (dati[i][col] !== "" && dati[i][col] != null) return dati[i][col];
  }
  return "--";
}

function animateValue(id, val) {
  const el = document.getElementById(id);
  if (el && val !== "--") {
    el.style.transition = 'color 0.3s';
    el.style.color = '#2e7fc2';
    setTimeout(() => el.style.color = '', 600);
  }
  if (el) el.innerText = val;
}

function aggiorna() {
  fetch(url)
    .then(r => r.json())
    .then(data => {
      if (!data.length) return;
      labels.length = 0;
      tempData.length = 0;
      luxData.length = 0;
      umidData.length = 0;
      predData.length = 0;

      data.forEach(r => {
        const t = parseFloat(r["Temperatura (¬∞C)"]);
        if (isNaN(t)) return;
        labels.push(r["DATA"]);
        tempData.push(t);
        luxData.push(parseFloat(r["Luminosit√†"]));
        umidData.push(parseFloat(r["Umidit√† (%)"]));
        predData.push(parseFloat(r["t predict"]) || null);
      });

      animateValue("temp",   ultimoValore("Temperatura (¬∞C)", data));
      animateValue("lux",    ultimoValore("Luminosit√†", data));
      animateValue("umid",   ultimoValore("Umidit√† (%)", data));
      animateValue("people", ultimoValore("NUMERO PERSONE", data));
      animateValue("tpred",  ultimoValore("t predict", data));
      animateValue("tempo",  ultimoValore("tempo", data));

      const now = new Date();
      document.getElementById("last-update").innerText =
        "Ultimo aggiornamento: " + now.getHours().toString().padStart(2,'0') + ":" +
        now.getMinutes().toString().padStart(2,'0') + ":" +
        now.getSeconds().toString().padStart(2,'0');

      tempChart.update('active');
      luxChart.update('active');
      umidChart.update('active');
    })
    .catch(() => {
      document.getElementById("last-update").innerText = "Connessione in attesa‚Ä¶";
    });
}

aggiorna();
setInterval(aggiorna, 5000);
</script>
</body>
</html>
